pipeline{
    agent any
    triggers {
        cron("0 * * * *")
    }
    stages{
        stage("SCM"){
            steps{
                git "https://github.com/Reddy-hub-sudo/spc-jenkins.git"
            }
        }
        stage("BUILD"){
            steps{
                 withSonarQubeEnv("sonarqube") {
                    sh script: "mvn clean package sonar:sonar"
                }
            }
        }
        stage("BUILD DOCKER IMAGE"){
            steps{
                sh "docker image build -t spc_dockerhub:1 ."
            }
        }
        stage("Push to Dockerhub"){
            steps{
                withCredentials([string(credentialsId: 'passwd', variable: 'docker_hub_passwd')]) {
                   sh "docker login -u vijendaraws -p ${docker_hub_passwd}"
                }
                sh "docker push spc_dockerhub:1"
            }
        }
        stage("POSTBUILD"){
            steps{
                 junit "target/surefire-reports/*.xml"
                 archiveArtifacts "target/*.jar"
            }
        }

    }
}
